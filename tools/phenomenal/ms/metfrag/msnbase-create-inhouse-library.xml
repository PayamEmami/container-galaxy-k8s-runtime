<?xml version='1.0' encoding='UTF-8'?>
<!--This is a configuration file for the integration of a tools into Galaxy (https://galaxyproject.org/).-->
<!--Proposed Tool Section: [PhenoMeNal]-->
<tool id="msnbase-create-inhouse-library" name="msnbase-create-inhouse-library" version="0.1">
<!--   <requirements>
        <container type="docker">container-registry.phenomenal-h2020.eu/phnmnl/msnbase</container>
  </requirements>-->
  <description>Run library mapping with given MS1, MS2 and characterization file.</description>
  <command><![CDATA[
 	/usr/local/bin/createLibrary.r inputCAMERA=$inputCAMERA inputMS2=$inputMS2 output=$output precursorppm=$precursorppm maxSpectra=$maxSpectra minPeaks=$minPeaks inputLibrary=$inputLibrary rawFileName=$rawFileName compundID=$compundID	compoundName=$compoundName mzCol=$mzCol whichmz=$whichmz
  ]]>
  </command>
  <inputs>
    <param name="inputMS" type="data" format="rdata" optional="False" label="map-msms2camera data" help="A rdata file mapped MS2 spectra retrieved from map-msms2camera" />
    <param name="inputCAMERA" type="data" format="rdata" optional="False" label="camera-find-adducts data" help="A rdata file with a xsAnnotate object from one sample with annotated adduct information" />
    <param name="inputLibrary" type="data" format="csv" optional="False" label="Library CSV file" help="The library characterization file. See the help" />
	<param name="rawFileName" type="text" format="txt" value="" optional="False" label="Column name showing name of the raw file in the library file" help="This must be a mzML file which has been processed using XCMS-CAMERA-MSNBASE" />
	<param name="compundID" type="text" format="txt" value="" optional="False" label="Column name showing ID of the compound in the library file" help="This must be unique for each compound like HMDB ID" />
	<param name="compoundName" type="text" format="txt" value="" optional="False" label="Column name showing name of the compound in the library file" help="This ideally must be unique for each compound like HMDB name" />
	<param name="mzCol" type="text" format="txt" value="" optional="False" label="Column name showing mz of the compound in the library file" help="This must show mz of your compounds" />
    <param name="whichmz" type="select" value="f" optional="False" label="whichmz" help="Should the script use feature range, center of the feature, order the parent MS2 mz for mapping">
      <option value="f" selected="True">Feature</option>
      <option value="c" selected="False">Center</option>
	  <option value="p" selected="False">Parent</option>
    </param>
	<param name="precursorppm" type="text" format="txt" value="10" optional="False" label="Precursor PPM" help="The ppm error for the precursor mass to search candidates" />
    <param name="minPeaks" type="text" format="txt" value="3" optional="True" label="Minimum number peaks" help="Filter spectra by a minimum number of fragment peaks" />
    <param name="maxSpectra" type="text" format="txt" value="10000" optional="True" label="Maximum number spectra" help="Filter spectra by a maximum number of fragment peaks" />
  </inputs>
  <outputs>
    <data name="output" type="text" format="csv" label="library result file" />
  </outputs>
  <help>

.. class:: infomark

| **Tool update: See the 'NEWS' section at the bottom of the page**

---------------------------------------------------

.. class:: infomark

**Authors**

| **Payam Emami (payam.emami@nbis.se)** wrote and maintains this script.

---------------------------------------------------

=========================
Create in-house library
=========================

-----------
Description
-----------

| This module is used to create and characterize in-house library. This is how it works: we assume that the library consists of one or more mzML files, each containing a number of compounds. 
| Each individual mzML file has been run through this XCMS->CAMERA(annotate, group, find adduct, find isotope)->MSMSToCamera
| It is important to format the library CSV file correctly. See the example in the help. This has to be run per library file. Later collectLibrary can be used to merge multiple runs. 
|

-----------
Input files
-----------

+------------------------------+------------+
| File                         |   Format   |
+==============================+============+
| 1)  inputMS2                 |    rdata   |
+------------------------------+------------+
| 2)  inputCAMERA              |    rdata   |
+------------------------------+------------+
| 3)  inputLibrary             |    csv     |
+------------------------------+------------+

----------
Parameters
----------

inputMS2
        | File (rdata) containing MS2 information generated by **msnbase-read-msms**
        |

inputCAMERA
        | File (rdata) containing MS1 information generated by **xcms-find-peaks->camera-annotate-peaks->camera-group-fwhm->camera-find-adducts->camera-find-isotopes**
        |

inputLibrary
	| This file must contain the following information in a comma separate file:
	| Name of the mzML file containing the compund
	| ID of the compound e.g. HMDB ID
	| Name of the compound
	| theoretical m/z of the compound
	| Here is an example of the expected table format
	|

+---------+--------------+--------------------+---------------+
| raw.File| HMDB.ID      | Name               | m.z           |
+=========+==============+====================+===============+
| a1.mzML | HMDB0000044  | Ascorbic acid      | 177.032087988 |
+---------+--------------+--------------------+---------------+
| a1.mzML | HMDB0000001  | 1-Methylhistidine  | 170.085126611 |
+---------+--------------+--------------------+---------------+
| a2.mzML | HMDB0000002  | 1,3-Diaminopropane | 75.08439833   |
+---------+--------------+--------------------+---------------+

rawFileName
	| Column name showing name of the raw file in the library file e.g. "raw.File" in the table above.
	|

compundID
	| Column name showing ID of the compound in the library file e.g. "HMDB.ID" in the table above.
	|
compoundName
	| Column name showing name of the compound in the library file e.g. "Name" in the table above.
	|

mzCol
	| Column name showing m/z of the compound in the library file e.g. "m.z" in the table above.
	|

whichmz
	| The script can use feature range (Feature), centroid (Center), and parent m/z (Parent) information in order to map a compound to MS1 and MS2 information.
	|

precursorppm
	| PPM tolerance for mapping experimental to theoretical mz.
	|

precursorppm
	| PPM tolerance for mapping experimental to theoretical mz.
	|

------------
Output files
------------

output
        | A csv output file with the mapped MS1 and MS2 for each compound. Use library collect to merge multiple runs.
        |

---------------------------------------------------

----
NEWS
----


CHANGES IN VERSION 0.1
========================

First version

  </help>
</tool>
